<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ü§ø MN90Mobile - Planificateur de Plong√©e</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(180deg, #001a33 0%, #003366 50%, #004d99 100%);
            min-height: 100vh;
            color: #fff;
            overflow-x: hidden;
            position: relative;
            padding-bottom: 420px;
        }

        /* ANIMATIONS */
        .bubbles {
            position: fixed;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        .bubble {
            position: absolute;
            bottom: -100px;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.8), rgba(255,255,255,0.2));
            border-radius: 50%;
            opacity: 0.6;
            animation: rise 8s infinite ease-in;
        }

        @keyframes rise {
            0% { bottom: -100px; transform: translateX(0); }
            50% { transform: translateX(100px); }
            100% { bottom: 110vh; transform: translateX(-50px); }
        }

        .bubble:nth-child(1) { left: 10%; animation-duration: 7s; animation-delay: 0s; width: 15px; height: 15px; }
        .bubble:nth-child(2) { left: 25%; animation-duration: 9s; animation-delay: 2s; width: 25px; height: 25px; }
        .bubble:nth-child(3) { left: 40%; animation-duration: 6s; animation-delay: 1s; width: 18px; height: 18px; }
        .bubble:nth-child(4) { left: 55%; animation-duration: 8s; animation-delay: 3s; width: 22px; height: 22px; }
        .bubble:nth-child(5) { left: 70%; animation-duration: 7.5s; animation-delay: 1.5s; width: 16px; height: 16px; }
        .bubble:nth-child(6) { left: 85%; animation-duration: 8.5s; animation-delay: 0.5s; width: 20px; height: 20px; }
        .bubble:nth-child(7) { left: 15%; animation-duration: 9.5s; animation-delay: 2.5s; width: 12px; height: 12px; }
        .bubble:nth-child(8) { left: 60%; animation-duration: 7s; animation-delay: 4s; width: 28px; height: 28px; }

        .diver { position: fixed; bottom: 20%; right: -100px; font-size: 60px; z-index: 1; animation: swim 20s infinite linear; filter: drop-shadow(0 0 10px rgba(0, 255, 255, 0.5)); }
        @keyframes swim { 0% { right: -100px; } 100% { right: 110%; } }

        .fish { position: fixed; font-size: 40px; z-index: 1; animation: swim-fish 25s infinite linear; filter: drop-shadow(0 0 5px rgba(100, 200, 255, 0.3)); }
        @keyframes swim-fish { 0% { right: -80px; } 100% { right: 110%; } }
        .fish:nth-child(10) { bottom: 35%; animation-duration: 22s; animation-delay: 1s; font-size: 35px; }
        .fish:nth-child(11) { bottom: 50%; animation-duration: 28s; animation-delay: 3s; font-size: 30px; }
        .fish:nth-child(12) { bottom: 25%; animation-duration: 30s; animation-delay: 5s; font-size: 32px; }

        .container {
            max-width: 500px;
            margin: 0 auto;
            position: relative;
            z-index: 10;
        }

        .header {
            background: linear-gradient(135deg, rgba(0, 102, 204, 0.95), rgba(0, 153, 255, 0.95));
            backdrop-filter: blur(10px);
            padding: 15px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 { font-size: 24px; margin-bottom: 5px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .header .subtitle { font-size: 11px; opacity: 0.95; margin-bottom: 8px; }
        .header .credits { font-size: 10px; opacity: 0.8; }
        .header .credits a { color: #00ffff; text-decoration: none; font-weight: bold; }

        .tabs {
            display: flex;
            gap: 8px;
            background: rgba(0, 51, 102, 0.8);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 80px;
            z-index: 99;
            padding: 8px;
            overflow-x: auto;
        }

        .tab-btn {
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            font-weight: 600;
            user-select: none;
            border-radius: 10px;
            white-space: nowrap;
            background: rgba(0, 153, 255, 0.2);
            color: #fff;
            font-size: 12px;
        }

        .tab-btn.active {
            background: rgba(0, 153, 255, 0.5);
            border-color: #00ffff;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
        }

        .tab-content { display: none; animation: fadeIn 0.5s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .tips-section {
            background: rgba(255, 193, 7, 0.15);
            padding: 12px;
            border-radius: 12px;
            border-left: 4px solid #ffc107;
            margin: 12px 8px;
            font-size: 12px;
        }

        .tips-section h4 { color: #ffc107; margin-bottom: 8px; }
        .tips-section ul { list-style-position: inside; color: rgba(255, 255, 255, 0.9); line-height: 1.6; }

        .collapsible-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            margin: 12px 8px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
        }

        .collapsible-header {
            background: linear-gradient(135deg, rgba(0, 153, 255, 0.3), rgba(0, 102, 204, 0.3));
            padding: 12px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            user-select: none;
            transition: all 0.3s;
        }

        .collapsible-header:hover { background: linear-gradient(135deg, rgba(0, 153, 255, 0.5), rgba(0, 102, 204, 0.5)); }
        .collapsible-header h2 { font-size: 16px; display: flex; align-items: center; gap: 8px; color: #00ffff; text-shadow: 0 0 10px rgba(0, 255, 255, 0.5); margin: 0; }
        .collapse-icon { font-size: 18px; transition: transform 0.3s; }
        .collapse-icon.open { transform: rotate(180deg); }

        .collapsible-content { padding: 15px; display: none; animation: slideDown 0.3s ease-out; }
        .collapsible-content.open { display: block; }
        @keyframes slideDown { from { opacity: 0; max-height: 0; } to { opacity: 1; max-height: 1000px; } }

        .input-card {
            background: linear-gradient(135deg, rgba(0, 153, 255, 0.2), rgba(0, 102, 204, 0.2));
            border: 2px solid #00ffff;
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 12px;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.2);
            animation: pulse 2s infinite;
        }

        @keyframes pulse { 0%, 100% { box-shadow: 0 0 20px rgba(0, 255, 255, 0.2); } 50% { box-shadow: 0 0 30px rgba(0, 255, 255, 0.4); } }

        .input-group { margin-bottom: 12px; }
        .input-label { display: block; font-weight: 600; margin-bottom: 6px; color: #ffffff; font-size: 13px; }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .checkbox-group input[type="checkbox"] { width: 20px; height: 20px; cursor: pointer; accent-color: #00ffff; }
        .checkbox-group label { cursor: pointer; font-weight: 600; color: #fff; font-size: 13px; }

        .select-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .select-group select {
            flex: 1;
            padding: 8px 10px;
            background: rgba(0, 102, 204, 0.3);
            border: 2px solid #00ffff;
            border-radius: 8px;
            color: #00ffff;
            font-weight: 600;
            cursor: pointer;
        }

        .select-group select option {
            background: #003366;
            color: #fff;
        }

        .select-help {
            font-size: 11px;
            color: #aaa;
            margin-top: 5px;
            line-height: 1.4;
        }

        .input-control {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-control {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #00ccff, #0099cc);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 204, 255, 0.4);
            transition: all 0.2s;
        }

        .btn-control:active { transform: scale(0.95); box-shadow: 0 2px 10px rgba(0, 204, 255, 0.6); }

        .slider-container { flex: 1; display: flex; flex-direction: column; gap: 5px; }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00ffff, #00ccff);
            cursor: pointer;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.8);
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00ffff, #00ccff);
            cursor: pointer;
            border: none;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.8);
        }

        .value-display {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            color: #00ffff;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
            min-width: 60px;
        }

        .result-box {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.1), rgba(0, 204, 255, 0.1));
            padding: 12px;
            border-radius: 10px;
            margin: 8px 0;
            border-left: 4px solid #00ffff;
        }

        .result-box.warning {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.2), rgba(255, 152, 0, 0.2));
            border-left-color: #ffc107;
        }

        .result-box.danger {
            background: linear-gradient(135deg, rgba(244, 67, 54, 0.2), rgba(229, 57, 53, 0.2));
            border-left-color: #f44336;
        }

        .result-label { font-size: 12px; color: rgba(255, 255, 255, 0.8); margin-bottom: 4px; }
        .result-value { font-size: 22px; font-weight: bold; color: #00ffff; text-shadow: 0 0 10px rgba(0, 255, 255, 0.6); }

        .result-box.warning .result-value { color: #ffc107; }
        .result-box.danger .result-value { color: #ff5252; }

        .alert {
            padding: 10px 12px;
            border-radius: 10px;
            margin: 8px 0;
            font-weight: 600;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .alert.info { background: rgba(33, 150, 243, 0.3); color: #64b5f6; border-left: 4px solid #2196f3; }
        .alert.warning { background: rgba(255, 152, 0, 0.3); color: #ffb74d; border-left: 4px solid #ff9800; }
        .alert.danger { background: rgba(244, 67, 54, 0.3); color: #ff5252; border-left: 4px solid #f44336; }

        .table-container { overflow-x: auto; margin: 8px 0; border-radius: 10px; background: rgba(0, 0, 0, 0.2); }
        table { width: 100%; border-collapse: collapse; font-size: 11px; }
        th { background: rgba(0, 153, 255, 0.3); padding: 8px 4px; font-weight: 600; color: #00ffff; }
        td { padding: 6px 4px; text-align: center; border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
        tbody tr:hover { background: rgba(0, 153, 255, 0.1); }

        .gps-A { background: rgba(76, 175, 80, 0.3); color: #69f0ae; font-weight: bold; }
        .gps-E { background: rgba(255, 193, 7, 0.3); color: #ffd54f; font-weight: bold; }
        .gps-H { background: rgba(255, 87, 34, 0.3); color: #ffab91; font-weight: bold; }
        .gps-M { background: rgba(180, 0, 0, 0.3); color: #ff1744; font-weight: bold; }
        .gps-P { background: rgba(144, 0, 0, 0.3); color: #d50000; font-weight: bold; }

        /* FOOTER FIXE AVEC GRAPHIQUE */
        .footer-graph {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 150;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(10px);
            border-top: 3px solid #00ffff;
            padding: 10px;
            max-height: 350px;
            overflow-y: auto;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.5);
        }

        .footer-graph-title {
            font-size: 13px;
            font-weight: bold;
            color: #00ffff;
            margin-bottom: 8px;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }

        .graph-container {
            width: 100%;
            height: 300px;
        }

        canvas { width: 100% !important; height: 300px !important; }

        .hidden { display: none; }

        @media (max-width: 480px) {
            .header h1 { font-size: 20px; }
            .tabs { gap: 5px; padding: 6px; }
            .tab-btn { padding: 6px 10px; font-size: 11px; }
            body { padding-bottom: 380px; }
        }
    </style>
</head>
<body>
    <div class="bubbles">
        <div class="bubble"></div><div class="bubble"></div><div class="bubble"></div><div class="bubble"></div>
        <div class="bubble"></div><div class="bubble"></div><div class="bubble"></div><div class="bubble"></div>
    </div>
    <div class="diver">ü§ø</div>
    <div class="fish">üê†</div><div class="fish">üêü</div><div class="fish">üê°</div>

    <div class="container">
        <div class="header">
            <h1>ü§ø MN90Mobile</h1>
            <div class="subtitle">Planificateur de Plong√©e ‚Ä¢ Paliers √† 6 m√®tres</div>
            <div class="credits">By <a href="https://github.com/SOARES-Denis" target="_blank">SOARES Denis</a> üê†</div>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('planner', this)">üìä Plan</button>
            <button class="tab-btn" onclick="switchTab('tables', this)">üìã Tables</button>
        </div>

        <div id="planner" class="tab-content active">
            <div class="tips-section">
                <h4>üí° Conseils de S√©curit√©</h4>
                <ul>
                    <li>üöÄ Vitesse remont√©e : 15-17 m/min max</li>
                    <li>‚è∏Ô∏è Palier recommand√© toujours</li>
                    <li>üìâ Plus profond en premier</li>
                    <li>‚è±Ô∏è Intervalle : 15min min</li>
                    <li>üë• Ne jamais plonger seul</li>
                    <li>üíß S'hydrater avant/apr√®s</li>
                </ul>
            </div>

            <!-- MENU PALIER -->
            <div class="collapsible-section">
                <div class="collapsible-header" onclick="toggleCollapsible(this, true)">
                    <h2>‚öôÔ∏è Configuration Palier</h2>
                    <span class="collapse-icon open">‚ñº</span>
                </div>
                <div class="collapsible-content open">
                    <div class="input-card">
                        <div class="input-group">
                            <label class="input-label">Type de Palier</label>
                            <div class="select-group">
                                <select id="palierType" onchange="updatePalierSelection()">
                                    <option value="6">Palier √† 6m (Standard)</option>
                                    <option value="5">Palier √† 5m</option>
                                    <option value="3">Palier √† 3m + 6m</option>
                                    <option value="7">Palier √† 7m</option>
                                </select>
                            </div>
                            <div class="select-help" id="palierHelp">
                                <strong>Standard FFESSM :</strong> Palier unique √† 6 m√®tres. C'est le plus couramment utilis√© en plong√©e r√©cr√©ative.
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PLONG√âE 1 -->
            <div class="collapsible-section">
                <div class="collapsible-header" onclick="toggleCollapsible(this, true)">
                    <h2>üåä Plong√©e 1</h2>
                    <span class="collapse-icon open">‚ñº</span>
                </div>
                <div class="collapsible-content open">
                    <div class="input-card">
                        <div class="input-group">
                            <label class="input-label">Profondeur (m√®tres)</label>
                            <div class="input-control">
                                <button class="btn-control" onclick="adjustValue('depth1', -1)">-</button>
                                <div class="slider-container">
                                    <input type="range" class="slider" id="depth1" min="6" max="65" value="20" step="1" oninput="updateValue('depth1')">
                                    <div class="value-display" id="depth1-value">20 m</div>
                                </div>
                                <button class="btn-control" onclick="adjustValue('depth1', 1)">+</button>
                            </div>
                        </div>

                        <div class="input-group">
                            <label class="input-label">Dur√©e (minutes)</label>
                            <div class="input-control">
                                <button class="btn-control" onclick="adjustValue('time1', -5)">-</button>
                                <div class="slider-container">
                                    <input type="range" class="slider" id="time1" min="5" max="60" value="45" step="5" oninput="updateValue('time1')">
                                    <div class="value-display" id="time1-value">45 min</div>
                                </div>
                                <button class="btn-control" onclick="adjustValue('time1', 5)">+</button>
                            </div>
                        </div>
                    </div>

                    <div class="result-box">
                        <div class="result-label">Palier</div>
                        <div class="result-value" id="palier1">-- min</div>
                    </div>

                    <div class="result-box">
                        <div class="result-label">GPS</div>
                        <div class="result-value" id="gps1">--</div>
                    </div>

                    <div class="result-box">
                        <div class="result-label">Temps remont√©e</div>
                        <div class="result-value" id="remontee1">-- min</div>
                    </div>
                </div>
            </div>

            <!-- PLONG√âE SUCCESSIVE -->
            <div class="collapsible-section">
                <div class="collapsible-header" onclick="toggleCollapsible(this)">
                    <h2>‚è±Ô∏è Plong√©e Successive</h2>
                    <span class="collapse-icon">‚ñº</span>
                </div>
                <div class="collapsible-content">
                    <div class="input-card">
                        <div class="checkbox-group">
                            <input type="checkbox" id="plongeeSuccessive" onchange="togglePlongee2()">
                            <label for="plongeeSuccessive">2√®me plong√©e</label>
                        </div>
                    </div>

                    <div id="intervalle-section" class="hidden">
                        <div class="input-card">
                            <div class="input-group">
                                <label class="input-label">Intervalle (minutes)</label>
                                <div class="input-control">
                                    <button class="btn-control" onclick="adjustValue('interval', -15)">-</button>
                                    <div class="slider-container">
                                        <input type="range" class="slider" id="interval" min="15" max="720" value="60" step="15" oninput="updateValue('interval')">
                                        <div class="value-display" id="interval-value">60 min</div>
                                    </div>
                                    <button class="btn-control" onclick="adjustValue('interval', 15)">+</button>
                                </div>
                            </div>
                        </div>

                        <div class="result-box warning">
                            <div class="result-label">Azote r√©siduel</div>
                            <div class="result-value" id="azoteResiduel">--</div>
                        </div>

                        <div class="input-card">
                            <div class="input-group">
                                <label class="input-label">Profondeur 2 (m)</label>
                                <div class="input-control">
                                    <button class="btn-control" onclick="adjustValue('depth2', -1)">-</button>
                                    <div class="slider-container">
                                        <input type="range" class="slider" id="depth2" min="6" max="65" value="15" step="1" oninput="updateValue('depth2')">
                                        <div class="value-display" id="depth2-value">15 m</div>
                                    </div>
                                    <button class="btn-control" onclick="adjustValue('depth2', 1)">+</button>
                                </div>
                            </div>

                            <div class="input-group">
                                <label class="input-label">Dur√©e 2 (min)</label>
                                <div class="input-control">
                                    <button class="btn-control" onclick="adjustValue('time2', -5)">-</button>
                                    <div class="slider-container">
                                        <input type="range" class="slider" id="time2" min="5" max="60" value="30" step="5" oninput="updateValue('time2')">
                                        <div class="value-display" id="time2-value">30 min</div>
                                    </div>
                                    <button class="btn-control" onclick="adjustValue('time2', 5)">+</button>
                                </div>
                            </div>
                        </div>

                        <div class="result-box warning">
                            <div class="result-label">Majoration</div>
                            <div class="result-value" id="majoration">-- min</div>
                        </div>

                        <div class="result-box">
                            <div class="result-label">Dur√©e fictive</div>
                            <div class="result-value" id="dureeFictive">-- min</div>
                        </div>

                        <div class="result-box">
                            <div class="result-label">Palier 2</div>
                            <div class="result-value" id="palier2">-- min</div>
                        </div>

                        <div class="result-box">
                            <div class="result-label">GPS 2</div>
                            <div class="result-value" id="gps2">--</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ALERTES -->
            <div class="collapsible-section">
                <div class="collapsible-header" onclick="toggleCollapsible(this, true)">
                    <h2>‚ö†Ô∏è Alertes</h2>
                    <span class="collapse-icon open">‚ñº</span>
                </div>
                <div class="collapsible-content open">
                    <div id="alerts"></div>
                </div>
            </div>

            <!-- TABLES -->
            <div class="collapsible-section">
                <div class="collapsible-header" onclick="toggleCollapsible(this)">
                    <h2>üìã Tables</h2>
                    <span class="collapse-icon">‚ñº</span>
                </div>
                <div class="collapsible-content">
                    <div style="font-size: 13px; font-weight: bold; color: #00ffff; margin: 10px 0;">üîµ Paliers</div>
                    <div class="table-container">
                        <table id="tablePaliers"></table>
                    </div>

                    <div style="font-size: 13px; font-weight: bold; color: #00ffff; margin: 10px 0;">üü¢ GPS</div>
                    <div class="table-container">
                        <table id="tableGPS"></table>
                    </div>
                </div>
            </div>
        </div>

        <!-- ONGLET TABLES -->
        <div id="tables" class="tab-content">
            <div class="collapsible-section">
                <div class="collapsible-header" onclick="toggleCollapsible(this, true)">
                    <h2>üìã Tables Compl√®tes</h2>
                    <span class="collapse-icon open">‚ñº</span>
                </div>
                <div class="collapsible-content open">
                    <div style="font-size: 13px; font-weight: bold; color: #00ffff; margin: 10px 0;">üîµ Paliers</div>
                    <div class="table-container">
                        <table id="tablePaliers2"></table>
                    </div>

                    <div style="font-size: 13px; font-weight: bold; color: #00ffff; margin: 10px 0;">üü¢ GPS</div>
                    <div class="table-container">
                        <table id="tableGPS2"></table>
                    </div>

                    <div style="font-size: 13px; font-weight: bold; color: #00ffff; margin: 10px 0;">üü† Azote</div>
                    <div class="table-container">
                        <table id="tableAzote2"></table>
                    </div>

                    <div style="font-size: 13px; font-weight: bold; color: #00ffff; margin: 10px 0;">üî¥ Majorations</div>
                    <div class="table-container">
                        <table id="tableMajorations2"></table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- FOOTER GRAPHIQUE -->
    <div class="footer-graph">
        <div class="footer-graph-title">üìä Profil Plong√©e</div>
        <div class="graph-container">
            <canvas id="profileCanvas"></canvas>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const tablesPaliers = {
            6: [0,0,0,0,0,0,0,0,0,0,0,0],
            8: [0,0,0,0,0,0,0,0,0,0,0,2],
            12: [0,0,0,0,0,2,2,4,5,6,7,9],
            15: [0,0,2,4,5,7,8,9,11,13,15,17],
            18: [0,2,4,7,9,11,13,15,18,20,23,25],
            20: [0,4,7,9,11,14,17,20,24,28,32,36],
            22: [0,7,9,11,13,16,19,23,27,31,36,40],
            25: [0,9,11,13,16,19,23,27,32,37,42,47],
            28: [0,11,13,16,19,23,28,33,38,44,50,56],
            30: [0,13,16,19,23,28,33,39,45,52,59,67],
            32: [0,15,19,23,28,33,40,46,53,61,69,78],
            35: [0,19,23,28,33,40,47,55,63,72,83,95],
            38: [0,23,28,33,40,47,55,64,75,86,99,113],
            40: [0,28,33,40,47,55,64,75,87,101,116,132],
            42: [0,33,40,47,55,64,75,88,102,117,135,155],
            45: [0,42,50,58,68,80,93,109,126,146,169,196],
            48: [0,51,61,71,83,97,113,133,154,179,209,244],
            50: [0,58,68,80,93,109,128,150,175,204,239,280],
            52: [0,66,78,91,106,124,146,171,200,234,275,323],
            55: [0,80,94,110,129,151,177,208,245,288,339,401],
            58: [0,96,113,133,156,183,215,253,298,352,415,492],
            60: [0,110,129,151,178,209,246,289,340,402,476,564],
            62: [0,125,148,173,203,238,281,331,391,462,548,651],
            65: [0,152,178,208,245,288,339,401,474,562,667,794]
        };

        const tablesGPS = {
            6: ['A','A','A','A','A','A','A','A','A','A','A','A'],
            8: ['A','A','A','A','A','A','A','A','A','A','A','B'],
            12: ['A','A','A','B','B','C','D','E','F','G','H','I'],
            15: ['A','A','B','C','D','E','F','G','H','I','J','K'],
            18: ['A','B','C','D','E','F','G','H','I','J','K','L'],
            20: ['A','C','D','E','F','G','H','I','J','K','L','M'],
            22: ['A','C','D','E','F','G','H','I','J','K','L','M'],
            25: ['B','D','E','F','G','H','I','J','K','L','M','N'],
            28: ['B','D','E','F','G','H','I','J','K','L','M','N'],
            30: ['B','E','F','G','H','I','J','K','L','M','N','O'],
            32: ['B','E','F','G','H','I','J','K','L','M','N','O'],
            35: ['C','F','G','H','I','J','K','L','M','N','O','P'],
            38: ['C','F','G','H','I','J','K','L','M','N','O','P'],
            40: ['C','G','H','I','J','K','L','M','N','O','P','P'],
            42: ['D','G','H','I','J','K','L','M','N','O','P','P'],
            45: ['D','H','I','J','K','L','M','N','O','P','P','P'],
            48: ['E','I','J','K','L','M','N','O','P','P','P','P'],
            50: ['E','I','J','K','L','M','N','O','P','P','P','P'],
            52: ['F','J','K','L','M','N','O','P','P','P','P','P'],
            55: ['G','K','L','M','N','O','P','P','P','P','P','P'],
            58: ['H','L','M','N','O','P','P','P','P','P','P','P'],
            60: ['I','M','N','O','P','P','P','P','P','P','P','P'],
            62: ['J','N','O','P','P','P','P','P','P','P','P','P'],
            65: ['K','O','P','P','P','P','P','P','P','P','P','P']
        };

        const tablesAzote = {
            'A': ['Z','Z','Z','Z','Z','Z','Z','Z','Z','Z','Z','Z'],
            'B': ['A','Z','Z','Z','Z','Z','Z','Z','Z','Z','Z','Z'],
            'C': ['B','A','Z','Z','Z','Z','Z','Z','Z','Z','Z','Z'],
            'D': ['C','B','A','Z','Z','Z','Z','Z','Z','Z','Z','Z'],
            'E': ['D','C','B','A','Z','Z','Z','Z','Z','Z','Z','Z'],
            'F': ['E','D','C','B','A','Z','Z','Z','Z','Z','Z','Z'],
            'G': ['F','E','D','C','B','A','Z','Z','Z','Z','Z','Z'],
            'H': ['G','F','E','D','C','B','A','Z','Z','Z','Z','Z'],
            'I': ['H','G','F','E','D','C','B','A','Z','Z','Z','Z'],
            'J': ['I','H','G','F','E','D','C','B','A','Z','Z','Z'],
            'K': ['J','I','H','G','F','E','D','C','B','A','Z','Z'],
            'L': ['K','J','I','H','G','F','E','D','C','B','A','Z'],
            'M': ['L','K','J','I','H','G','F','E','D','C','B','A'],
            'N': ['M','L','K','J','I','H','G','F','E','D','C','B'],
            'O': ['N','M','L','K','J','I','H','G','F','E','D','C'],
            'P': ['O','N','M','L','K','J','I','H','G','F','E','D']
        };

        const tablesMajorations = {
            'A': [0,0,1,2,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13],
            'B': [0,0,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],
            'C': [0,0,5,6,7,8,10,12,13,14,16,16,18,19,21,23,25,27,29,31,33,35,37,39],
            'D': [0,0,7,8,10,12,14,16,17,19,21,22,25,27,29,32,35,38,41,44,47,50,53,56],
            'E': [0,0,9,11,13,15,17,20,22,23,26,28,32,35,38,42,46,50,54,58,62,66,70,74],
            'F': [0,0,11,13,15,18,21,24,26,28,31,34,39,43,47,52,57,62,67,72,77,82,87,92],
            'G': [0,0,13,15,18,21,24,28,31,33,37,40,46,51,56,62,68,74,80,86,92,98,104,110],
            'H': [0,0,15,18,21,24,28,33,37,39,44,47,54,60,66,73,80,87,94,101,108,115,122,129],
            'I': [0,0,17,20,24,28,33,39,44,47,52,56,64,71,78,86,94,102,110,118,126,134,142,150],
            'J': [0,0,20,24,28,33,39,46,52,56,62,67,76,84,92,101,110,119,128,137,146,155,164,173],
            'K': [0,0,23,28,33,39,46,54,61,66,73,79,90,99,108,118,128,138,148,158,168,178,188,198],
            'L': [0,0,27,33,39,46,54,63,72,77,86,93,106,117,128,140,152,164,176,188,200,212,224,236],
            'M': [0,0,32,39,46,54,63,74,84,91,101,109,124,137,150,164,178,192,206,220,234,248,262,276],
            'N': [0,0,38,46,54,63,74,86,98,106,118,128,146,161,176,192,208,224,240,256,272,288,304,320],
            'O': [0,0,45,54,63,74,86,100,114,123,137,149,170,188,206,225,244,263,282,301,320,339,358,377],
            'P': [0,0,53,63,74,86,100,116,132,143,159,172,197,218,239,261,283,305,327,349,371,393,415,437]
        };

        const times = [5,10,15,20,25,30,35,40,45,50,55,60];
        const intervals = [15,30,45,60,90,120,180,240,360,480,600,720];
        const depths = [6,8,12,15,18,20,22,25,28,30,32,35,38,40,42,45,48,50,52,55,58,60,62,65];

        let chart = null;

        function switchTab(tabName, btn) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            btn.classList.add('active');

            if (tabName === 'tables') {
                generateTables('tablePaliers2', 'tableGPS2', 'tableAzote2', 'tableMajorations2');
            }
        }

        function toggleCollapsible(header, forceOpen = false) {
            const content = header.nextElementSibling;
            const icon = header.querySelector('.collapse-icon');
            const isOpen = content.classList.contains('open');
            
            if (forceOpen && isOpen) return;
            
            if (isOpen) {
                content.classList.remove('open');
                icon.classList.remove('open');
            } else {
                content.classList.add('open');
                icon.classList.add('open');
            }
        }

        function updatePalierSelection() {
            const palierType = document.getElementById('palierType').value;
            const helpText = {
                '6': '<strong>Standard FFESSM :</strong> Palier unique √† 6 m√®tres. C\'est le plus couramment utilis√© en plong√©e r√©cr√©ative fran√ßaise.',
                '5': '<strong>Palier √† 5m :</strong> Entre 6m et 3m. Moins courant, mais peut √™tre utilis√© en cas de besoin.',
                '3': '<strong>Palier de s√©curit√© :</strong> Palier √† 3m apr√®s 6m. Recommand√© en cas de fatigue ou d\'efforts intenses.',
                '7': '<strong>Palier profond :</strong> √Ä 7m. Plus rare, utilis√© dans certains contextes sp√©cifiques. Plus rapide que 6m mais plus risqu√©.'
            };
            document.getElementById('palierHelp').innerHTML = helpText[palierType];
            calculate();
        }

        function togglePlongee2() {
            const checkbox = document.getElementById('plongeeSuccessive');
            const intervalle = document.getElementById('intervalle-section');
            
            if (checkbox.checked) {
                intervalle.classList.remove('hidden');
            } else {
                intervalle.classList.add('hidden');
            }
            calculate();
        }

        function adjustValue(id, delta) {
            const input = document.getElementById(id);
            let value = parseInt(input.value);
            const min = parseInt(input.min);
            const max = parseInt(input.max);
            
            value = Math.max(min, Math.min(max, value + delta));
            input.value = value;
            updateValue(id);
        }

        function updateValue(id) {
            const input = document.getElementById(id);
            const display = document.getElementById(id + '-value');
            const unit = id.includes('depth') ? ' m' : ' min';
            display.textContent = input.value + unit;
            calculate();
        }

        function findClosest(arr, val) {
            return arr.reduce((prev, curr) => 
                Math.abs(curr - val) < Math.abs(prev - val) ? curr : prev
            );
        }

        function getTableValue(table, depth, time) {
            const closestDepth = findClosest(depths, depth);
            const closestTime = findClosest(times, time);
            const timeIndex = times.indexOf(closestTime);
            return table[closestDepth][timeIndex];
        }

        function getAzoteValue(gps, interval) {
            if (!gps || gps === '--') return 'Z';
            const closestInterval = findClosest(intervals, interval);
            const intervalIndex = intervals.indexOf(closestInterval);
            return tablesAzote[gps][intervalIndex];
        }

        function getMajorationValue(azote, depth) {
            if (!azote || azote === 'Z' || azote === '--') return 0;
            const closestDepth = findClosest(depths, depth);
            const depthIndex = depths.indexOf(closestDepth);
            return tablesMajorations[azote][depthIndex];
        }

        function calculate() {
            const depth1 = parseInt(document.getElementById('depth1').value) || 0;
            const time1 = parseInt(document.getElementById('time1').value) || 0;
            const interval = parseInt(document.getElementById('interval').value) || 0;
            const depth2 = parseInt(document.getElementById('depth2').value) || 0;
            const time2 = parseInt(document.getElementById('time2').value) || 0;
            const hasPlongee2 = document.getElementById('plongeeSuccessive').checked;

            if (depth1 > 0 && time1 > 0) {
                const palier1 = getTableValue(tablesPaliers, depth1, time1);
                const gps1 = getTableValue(tablesGPS, depth1, time1);
                const remontee1 = palier1 + Math.ceil(depth1 / 15);

                document.getElementById('palier1').textContent = palier1 + ' min';
                document.getElementById('gps1').textContent = gps1;
                document.getElementById('remontee1').textContent = remontee1 + ' min';

                if (hasPlongee2 && interval > 0 && gps1) {
                    const azoteResiduel = getAzoteValue(gps1, interval);
                    document.getElementById('azoteResiduel').textContent = azoteResiduel;

                    if (depth2 > 0 && time2 > 0) {
                        const majoration = getMajorationValue(azoteResiduel, depth2);
                        const dureeFictive = time2 + majoration;
                        const palier2 = getTableValue(tablesPaliers, depth2, dureeFictive);
                        const gps2 = getTableValue(tablesGPS, depth2, dureeFictive);

                        document.getElementById('majoration').textContent = majoration + ' min';
                        document.getElementById('dureeFictive').textContent = dureeFictive + ' min';
                        document.getElementById('palier2').textContent = palier2 + ' min';
                        document.getElementById('gps2').textContent = gps2;
                    }
                }
            }

            updateAlerts();
            updateChart();
        }

        function updateAlerts() {
            const depth1 = parseInt(document.getElementById('depth1').value) || 0;
            const depth2 = parseInt(document.getElementById('depth2').value) || 0;
            const interval = parseInt(document.getElementById('interval').value) || 0;
            const palier1 = parseInt(document.getElementById('palier1').textContent) || 0;
            const hasPlongee2 = document.getElementById('plongeeSuccessive').checked;

            let alerts = '';

            if (depth1 > 60) {
                alerts += '<div class="alert danger">‚õî Profondeur > 60m - DANGEREUX!</div>';
            } else if (depth1 > 40) {
                alerts += '<div class="alert warning">‚ö†Ô∏è Profondeur > 40m - Vigilance</div>';
            }

            if (palier1 > 20) {
                alerts += '<div class="alert warning">‚ö†Ô∏è Palier > 20min</div>';
            }

            if (hasPlongee2 && depth2 > 0 && depth2 > depth1) {
                alerts += '<div class="alert danger">‚õî Erreur: P2 > P1!</div>';
            }

            if (hasPlongee2 && interval > 0 && interval < 15) {
                alerts += '<div class="alert warning">‚ö†Ô∏è Intervalle < 15min</div>';
            }

            document.getElementById('alerts').innerHTML = alerts || '<div class="alert info">‚úÖ Configuration OK</div>';
        }

        function updateChart() {
            const depth1 = parseInt(document.getElementById('depth1').value) || 0;
            const time1 = parseInt(document.getElementById('time1').value) || 0;
            const palier1 = parseInt(document.getElementById('palier1').textContent) || 0;
            const remonteeTime = Math.ceil(depth1 / 15);

            const depth2 = parseInt(document.getElementById('depth2').value) || 0;
            const time2 = parseInt(document.getElementById('time2').value) || 0;
            const palier2 = parseInt(document.getElementById('palier2').textContent) || 0;
            const interval = parseInt(document.getElementById('interval').value) || 0;
            const hasPlongee2 = document.getElementById('plongeeSuccessive').checked;
            const remonteeTime2 = Math.ceil(depth2 / 15);

            const datasets = [];

            datasets.push({
                label: 'Plong√©e 1',
                data: [0, -depth1, -depth1, -6, -6, 0],
                borderColor: '#0099ff',
                backgroundColor: 'rgba(0, 153, 255, 0.15)',
                borderWidth: 2.5,
                fill: true,
                tension: 0,
                pointBackgroundColor: '#0099ff',
                pointBorderColor: '#fff',
                pointBorderWidth: 2,
                pointRadius: 4
            });

            if (hasPlongee2 && depth2 > 0 && time2 > 0) {
                const startTime = 2 + time1 + remonteeTime + palier1 + interval + 2;
                datasets.push({
                    label: 'Plong√©e 2',
                    data: [
                        {x: startTime - 1, y: 0},
                        {x: startTime + 1, y: -depth2},
                        {x: startTime + time2 + 1, y: -depth2},
                        {x: startTime + time2 + remonteeTime2 + 1, y: -6},
                        {x: startTime + time2 + remonteeTime2 + palier2 + 1, y: -6},
                        {x: startTime + time2 + remonteeTime2 + palier2 + 2, y: 0}
                    ],
                    borderColor: '#9933ff',
                    backgroundColor: 'rgba(153, 51, 255, 0.15)',
                    borderWidth: 2.5,
                    fill: true,
                    tension: 0,
                    pointBackgroundColor: '#9933ff',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    pointRadius: 4
                });
            }

            const labels = ['0', '2', 2 + time1, 2 + time1 + remonteeTime, 2 + time1 + remonteeTime + palier1, 2 + time1 + remonteeTime + palier1 + 1];

            const data = { labels: labels, datasets: datasets };

            const config = {
                type: 'line',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: datasets.length > 1, labels: { color: '#fff' } },
                        title: { display: true, text: 'Profil de Plong√©e', color: '#00ffff', font: { size: 14, weight: 'bold' } },
                        annotation: {
                            drawTime: 'beforeDraw',
                            annotations: {
                                dangerBox: {
                                    type: 'box',
                                    xMin: 0,
                                    xMax: 'max',
                                    yMin: -65,
                                    yMax: -40,
                                    backgroundColor: 'rgba(244, 67, 54, 0.15)',
                                    borderWidth: 0
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            title: { display: true, text: 'Profondeur (m)', color: '#fff' },
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        x: {
                            title: { display: true, text: 'Temps (min)', color: '#fff' },
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            };

            if (chart) chart.destroy();
            const ctx = document.getElementById('profileCanvas').getContext('2d');
            chart = new Chart(ctx, config);
        }

        function generateTables(paliersId, gpsId, azoteId, majorId) {
            let html = '<thead><tr><th>P</th>';
            times.forEach(t => html += `<th>${t}</th>`);
            html += '</tr></thead><tbody>';
            depths.forEach(d => {
                html += `<tr><td><b>${d}</b></td>`;
                tablesPaliers[d].forEach(p => html += `<td>${p}</td>`);
                html += '</tr>';
            });
            html += '</tbody>';
            document.getElementById(paliersId).innerHTML = html;

            html = '<thead><tr><th>P</th>';
            times.forEach(t => html += `<th>${t}</th>`);
            html += '</tr></thead><tbody>';
            depths.forEach(d => {
                html += `<tr><td><b>${d}</b></td>`;
                tablesGPS[d].forEach(g => {
                    const bgClass = `gps-${g}`;
                    html += `<td class="${bgClass}">${g}</td>`;
                });
                html += '</tr>';
            });
            html += '</tbody>';
            document.getElementById(gpsId).innerHTML = html;

            if (azoteId) {
                html = '<thead><tr><th>GPS</th>';
                intervals.forEach(i => html += `<th>${i}</th>`);
                html += '</tr></thead><tbody>';
                Object.keys(tablesAzote).forEach(gps => {
                    html += `<tr><td><b>${gps}</b></td>`;
                    tablesAzote[gps].forEach(a => {
                        const bgClass = `gps-${a}`;
                        html += `<td class="${bgClass}">${a}</td>`;
                    });
                    html += '</tr>';
                });
                html += '</tbody>';
                document.getElementById(azoteId).innerHTML = html;
            }

            if (majorId) {
                html = '<thead><tr><th>Azote</th>';
                depths.forEach(d => html += `<th>${d}</th>`);
                html += '</tr></thead><tbody>';
                Object.keys(tablesMajorations).forEach(azote => {
                    html += `<tr><td><b>${azote}</b></td>`;
                    tablesMajorations[azote].forEach(m => html += `<td>${m}</td>`);
                    html += '</tr>';
                });
                html += '</tbody>';
                document.getElementById(majorId).innerHTML = html;
            }
        }

        generateTables('tablePaliers', 'tableGPS', '', '');
        calculate();
    </script>
</body>
</html>